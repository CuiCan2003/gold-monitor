# 📊 24小时API稳定性测试指南

## 🎯 测试目的
验证 `https://i.jzj9999.com/res/quote/pq.json` 接口：
- ✅ 是否有请求频率限制
- ✅ 是否会被封IP
- ✅ 数据更新频率
- ✅ 夜间是否停止更新
- ✅ 成功率是否稳定

---

## 🚀 开始测试

### 1️⃣ 打开测试工具
使用：`黄金价格监控-终极版.html`

### 2️⃣ 确保环境正常
- ✅ CORS插件已启用（显示 C ON）
- ✅ 点击"测试API连接"成功
- ✅ 电脑不会自动休眠
- ✅ 浏览器不会自动关闭

### 3️⃣ 开始监控
1. 点击"▶ 开始监控"
2. 记录开始时间：________________
3. 检查日志显示绿色 ✅

### 4️⃣ 防止中断的设置

**Windows系统：**
```
控制面板 → 电源选项 → 更改计划设置
- 关闭显示器：从不
- 使计算机进入睡眠状态：从不
```

**Chrome浏览器：**
```
设置 → 系统 → 关闭"在后台继续运行应用"（取消勾选会导致关闭浏览器时停止）
```

---

## 📊 测试期间需要观察的指标

### 关键指标：

| 指标 | 预期目标 | 实际结果 |
|------|---------|---------|
| 成功率 | > 95% | _______ |
| 总请求次数 | ~86,400次 (24h×3600s) | _______ |
| 失败次数 | < 4,320次 | _______ |
| 数据记录条数 | ~86,400条 | _______ |

### 每隔4小时检查一次：

**第1次检查（4小时后）**
- 时间：________________
- 成功率：_______%
- 失败次数：_______
- 备注：________________

**第2次检查（8小时后）**
- 时间：________________
- 成功率：_______%
- 失败次数：_______
- 备注：________________

**第3次检查（12小时后）**
- 时间：________________
- 成功率：_______%
- 失败次数：_______
- 备注：________________

**第4次检查（16小时后）**
- 时间：________________
- 成功率：_______%
- 失败次数：_______
- 备注：________________

**第5次检查（20小时后）**
- 时间：________________
- 成功率：_______%
- 失败次数：_______
- 备注：________________

**最终检查（24小时后）**
- 时间：________________
- 成功率：_______%
- 总请求：_______次
- 成功：_______次
- 失败：_______次
- 记录数据：_______条

---

## 🔍 需要特别关注的问题

### ⚠️ 如果出现以下情况，请记录：

1. **连续失败**
   - 如果连续失败超过10次 → 记录时间和原因
   - 可能原因：服务器维护、网络问题、IP被限制

2. **数据不更新**
   - 如果价格长时间不变 → 记录时间段
   - 可能是交易时间外（晚上/周末）

3. **失败率突然上升**
   - 记录失败率变化的时间点
   - 查看日志中的错误信息（HTTP 403、500等）

4. **浏览器崩溃**
   - 数据已自动保存到localStorage
   - 重新打开页面会自动恢复数据

---

## 📥 测试完成后的操作

### 1️⃣ 导出数据
- 点击"📥 导出CSV" - 用于Excel分析
- 点击"📥 导出JSON" - 完整数据备份
- 点击"📊 导出Excel" - 直接查看

### 2️⃣ 分析数据

打开CSV文件，检查：
- ✅ 价格是否实时变化
- ✅ 是否有长时间价格不变的情况
- ✅ 哪些品种更新频繁
- ✅ 夜间是否有数据

### 3️⃣ 截图保存
- 最终统计数据截图
- 运行日志截图
- 价格显示截图

---

## 🎯 测试结论模板

```
===========================================
24小时API稳定性测试报告
===========================================

测试时间：
开始：________________
结束：________________

测试结果：
✅/❌ 总请求次数：_______次
✅/❌ 成功次数：_______次
✅/❌ 失败次数：_______次
✅/❌ 成功率：_______%

数据质量：
✅/❌ 价格更新及时
✅/❌ 数据格式稳定
✅/❌ 无异常中断
✅/❌ 夜间正常运行

是否适合集成到主网站：
☐ 是 - 完全可靠，可以集成
☐ 否 - 不稳定，需要备用方案
☐ 部分 - 需要添加错误处理机制

备注：
_________________________________________
_________________________________________
_________________________________________
```

---

## 💡 如果测试成功后，集成到主网站的方案

### 方案A：继续使用CORS插件（仅个人使用）
- 优点：最简单
- 缺点：其他人访问你的网站时无法使用

### 方案B：部署到Vercel + 后端代理（推荐）
- 优点：所有人都能访问，无需插件
- 缺点：需要一点点配置（我可以帮你做）

### 方案C：集成到你的其他工具
如果你有Python后端或Node.js后端：
```python
# Python示例
import requests

def get_gold_price():
    url = "https://i.jzj9999.com/res/quote/pq.json"
    response = requests.get(url)
    data = response.json()

    # 提取黄金价格
    for item in data['items']:
        if item['code'] == 'JZJ_au':  # 黄金(元/克)
            return item['bidprice']
```

---

## 🆘 常见问题

**Q: 中途关闭了浏览器怎么办？**
A: 数据已自动保存，重新打开页面会恢复。但统计数据（请求次数）会重置，需要手动记录。

**Q: 成功率低于90%怎么办？**
A: 可能是网络问题或API不稳定，建议：
1. 检查自己的网络连接
2. 换个时间段再测试
3. 考虑使用备用API

**Q: 电脑必须一直开着吗？**
A: 是的，关机或休眠会停止测试。可以考虑：
1. 使用服务器或云主机测试
2. 使用不常用的电脑挂机
3. 调整电源设置防止休眠

**Q: 浏览器可以最小化吗？**
A: 可以，但不要关闭标签页。

**Q: 测试期间可以用浏览器干别的吗？**
A: 可以开其他标签页，但不要关闭测试页面。

---

## ✅ 测试前检查清单

在开始24小时测试前，确认：

- [ ] CORS插件已安装并启用
- [ ] 点击"测试API连接"成功
- [ ] 电脑电源设置为"从不休眠"
- [ ] 浏览器不会自动关闭
- [ ] 网络连接稳定
- [ ] 有足够的磁盘空间（至少1GB）
- [ ] 记录了开始时间
- [ ] 设置了每4小时的提醒（可选）

开始测试！🚀
