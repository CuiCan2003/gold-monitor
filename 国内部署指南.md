# ğŸ‡¨ğŸ‡³ å›½å†…æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸ¯ æ–¹æ¡ˆé€‰æ‹©

ç”±äºVercelåœ¨å›½å†…è®¿é—®å¯èƒ½å—é™ï¼Œè¿™é‡Œæä¾›å›½å†…éƒ¨ç½²æ–¹æ¡ˆã€‚

---

## âš¡ æ–¹æ¡ˆ1: ç›´æ¥åœ¨ä½ çš„æœåŠ¡å™¨è¿è¡Œ (æœ€ç®€å•)

### ä¼˜åŠ¿
- âœ… å®Œå…¨å¯æ§
- âœ… å›½å†…è®¿é—®å¿«
- âœ… ä¸éœ€è¦æ³¨å†Œä»»ä½•äº‘æœåŠ¡
- âœ… 24å°æ—¶è¿è¡Œ,ä»·æ ¼å®æ—¶æ›´æ–°

### æ­¥éª¤

#### 1ï¸âƒ£ å®‰è£…ä¾èµ–

```bash
cd D:\API\å¤§å®—å•†å“ä»·æ ¼ç›‘æ§
pip install -r requirements-server.txt
```

æˆ–è€…å•ç‹¬å®‰è£…:
```bash
pip install flask==3.0.0
pip install flask-cors==4.0.0
pip install websocket-client==1.6.4
```

#### 2ï¸âƒ£ å¯åŠ¨æœåŠ¡å™¨

```bash
python server.py
```

ä½ ä¼šçœ‹åˆ°:
```
============================================================
ğŸš€ å¤§å®—å•†å“ä»·æ ¼ç›‘æ§æœåŠ¡å™¨å¯åŠ¨ä¸­...
============================================================
ğŸ“… å¯åŠ¨æ—¶é—´: 2025-10-20 15:30:00
ğŸŒ è®¿é—®åœ°å€: http://localhost:5000
ğŸ“Š APIåœ°å€: http://localhost:5000/api/prices
============================================================
[2025-10-20 15:30:03] WebSocketè¿æ¥æˆåŠŸ
[2025-10-20 15:30:05] æ›´æ–°ä»·æ ¼: é»„é‡‘(ä¹°) = 971.0 CNY/g
[2025-10-20 15:30:05] æ›´æ–°ä»·æ ¼: ç™½é“¶(ä¹°) = 11.76 CNY/g
```

#### 3ï¸âƒ£ æµ‹è¯•

æ‰“å¼€æµè§ˆå™¨:
- **ä¸»é¡µ**: http://localhost:5000
- **API**: http://localhost:5000/api/prices

âœ… **å®Œæˆï¼æœ¬åœ°å¯ä»¥è®¿é—®äº†ï¼**

---

## ğŸŒ è®©å¤–ç½‘ä¹Ÿèƒ½è®¿é—®

### é€‰é¡¹A: ä½¿ç”¨å†…ç½‘ç©¿é€ (æœ€å¿«)

#### ä½¿ç”¨ ngrok (å…è´¹)

1. ä¸‹è½½ ngrok: https://ngrok.com/download
2. è¿è¡Œ:
   ```bash
   ngrok http 5000
   ```
3. ä¼šå¾—åˆ°ä¸€ä¸ªå…¬ç½‘åœ°å€:
   ```
   https://xxxx-xx-xx-xx-xx.ngrok-free.app
   ```

**ä¼˜ç‚¹**: 5åˆ†é’Ÿæå®š
**ç¼ºç‚¹**: åŸŸåæ¯æ¬¡é‡å¯ä¼šå˜

#### ä½¿ç”¨ frp (è‡ªå»º)

å¦‚æœä½ æœ‰å…¬ç½‘æœåŠ¡å™¨,å¯ä»¥ç”¨frpåšå†…ç½‘ç©¿é€

---

### é€‰é¡¹B: äº‘æœåŠ¡å™¨éƒ¨ç½²

#### è…¾è®¯äº‘è½»é‡åº”ç”¨æœåŠ¡å™¨

**ä»·æ ¼**: çº¦60å…ƒ/å¹´ (å­¦ç”Ÿä»·)

**æ­¥éª¤**:

1. **è´­ä¹°æœåŠ¡å™¨**
   - è®¿é—®: https://cloud.tencent.com/
   - é€‰æ‹©"è½»é‡åº”ç”¨æœåŠ¡å™¨"
   - åœ°åŸŸ: å›½å†…ä»»æ„
   - é•œåƒ: Ubuntu 22.04

2. **è¿æ¥æœåŠ¡å™¨**
   ```bash
   ssh ubuntu@ä½ çš„æœåŠ¡å™¨IP
   ```

3. **å®‰è£…Pythonå’Œä¾èµ–**
   ```bash
   sudo apt update
   sudo apt install python3-pip python3-venv -y
   ```

4. **ä¸Šä¼ ä»£ç **
   ```bash
   # æ–¹å¼1: ä½¿ç”¨git
   git clone https://github.com/ä½ çš„ç”¨æˆ·å/commodity-price-monitor.git
   cd commodity-price-monitor

   # æ–¹å¼2: ä½¿ç”¨scpä»æœ¬åœ°ä¸Šä¼ 
   # åœ¨ä½ çš„æœ¬åœ°ç”µè„‘è¿è¡Œ:
   scp -r "D:\API\å¤§å®—å•†å“ä»·æ ¼ç›‘æ§" ubuntu@ä½ çš„æœåŠ¡å™¨IP:/home/ubuntu/
   ```

5. **å®‰è£…ä¾èµ–**
   ```bash
   pip3 install -r requirements-server.txt
   ```

6. **è¿è¡ŒæœåŠ¡å™¨**
   ```bash
   python3 server.py
   ```

7. **é…ç½®é˜²ç«å¢™**
   ```bash
   # è…¾è®¯äº‘æ§åˆ¶å° â†’ é˜²ç«å¢™ â†’ æ·»åŠ è§„åˆ™
   # ç«¯å£: 5000
   # åè®®: TCP
   ```

8. **è®¿é—®ç½‘ç«™**
   ```
   http://ä½ çš„æœåŠ¡å™¨IP:5000
   ```

---

### é€‰é¡¹C: ä½¿ç”¨Nginxåå‘ä»£ç†

è®©ç½‘ç«™è¿è¡Œåœ¨80ç«¯å£(http://ä½ çš„åŸŸå)

#### 1. å®‰è£…Nginx

```bash
sudo apt install nginx -y
```

#### 2. é…ç½®Nginx

```bash
sudo nano /etc/nginx/sites-available/gold-monitor
```

ç²˜è´´ä»¥ä¸‹å†…å®¹:

```nginx
server {
    listen 80;
    server_name ä½ çš„åŸŸå.com;  # æ”¹æˆä½ çš„åŸŸå

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/ {
        proxy_pass http://127.0.0.1:5000/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

#### 3. å¯ç”¨é…ç½®

```bash
sudo ln -s /etc/nginx/sites-available/gold-monitor /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

#### 4. é…ç½®åŸŸå

åœ¨ä½ çš„åŸŸåå•†åå°:
```
ç±»å‹: A
ä¸»æœºè®°å½•: @ (æˆ– gold)
è®°å½•å€¼: ä½ çš„æœåŠ¡å™¨IP
```

#### 5. è®¿é—®ç½‘ç«™

```
http://ä½ çš„åŸŸå.com
```

---

## ğŸ”„ è®©æœåŠ¡å™¨åå°è¿è¡Œ

### ä½¿ç”¨ screen (æ¨è)

```bash
# å®‰è£…screen
sudo apt install screen -y

# åˆ›å»ºæ–°ä¼šè¯
screen -S gold-monitor

# è¿è¡ŒæœåŠ¡å™¨
python3 server.py

# æŒ‰ Ctrl+A, ç„¶åæŒ‰ D é€€å‡ºä¼šè¯(æœåŠ¡å™¨ç»§ç»­è¿è¡Œ)

# é‡æ–°è¿æ¥ä¼šè¯
screen -r gold-monitor
```

### ä½¿ç”¨ systemd (å¼€æœºè‡ªå¯)

#### 1. åˆ›å»ºæœåŠ¡æ–‡ä»¶

```bash
sudo nano /etc/systemd/system/gold-monitor.service
```

ç²˜è´´:

```ini
[Unit]
Description=Gold Price Monitor
After=network.target

[Service]
Type=simple
User=ubuntu
WorkingDirectory=/home/ubuntu/commodity-price-monitor
ExecStart=/usr/bin/python3 /home/ubuntu/commodity-price-monitor/server.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

#### 2. å¯ç”¨æœåŠ¡

```bash
sudo systemctl daemon-reload
sudo systemctl enable gold-monitor
sudo systemctl start gold-monitor
```

#### 3. æŸ¥çœ‹çŠ¶æ€

```bash
sudo systemctl status gold-monitor
```

#### 4. æŸ¥çœ‹æ—¥å¿—

```bash
sudo journalctl -u gold-monitor -f
```

---

## ğŸ“Š éƒ¨ç½²å¯¹æ¯”

| æ–¹æ¡ˆ | éš¾åº¦ | è´¹ç”¨ | é€Ÿåº¦ | ç¨³å®šæ€§ |
|------|------|------|------|--------|
| æœ¬åœ°è¿è¡Œ | â­ | å…è´¹ | å¿« | å–å†³äºä½ çš„ç”µè„‘ |
| å†…ç½‘ç©¿é€(ngrok) | â­ | å…è´¹ | ä¸­ | ä¸€èˆ¬ |
| è…¾è®¯äº‘æœåŠ¡å™¨ | â­â­ | ~60å…ƒ/å¹´ | å¾ˆå¿« | å¾ˆå¥½ |
| é˜¿é‡Œäº‘æœåŠ¡å™¨ | â­â­ | ~60å…ƒ/å¹´ | å¾ˆå¿« | å¾ˆå¥½ |

---

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### å¦‚æœåªæ˜¯è‡ªå·±ç”¨æˆ–æµ‹è¯•:
**â†’ æœ¬åœ°è¿è¡Œ `python server.py`**

### å¦‚æœéœ€è¦ç»™å®¢æˆ·è®¿é—®:
**â†’ è…¾è®¯äº‘/é˜¿é‡Œäº‘æœåŠ¡å™¨ (60å…ƒ/å¹´)**

### å¦‚æœéœ€è¦å¿«é€Ÿå±•ç¤º:
**â†’ ngrokå†…ç½‘ç©¿é€ (5åˆ†é’Ÿæå®š)**

---

## ğŸ§ª å¿«é€Ÿæµ‹è¯•

æ— è®ºå“ªç§æ–¹æ¡ˆ,æµ‹è¯•æ­¥éª¤éƒ½ä¸€æ ·:

1. **æµ‹è¯•API**
   ```
   http://ä½ çš„åœ°å€/api/prices
   ```
   åº”è¯¥è¿”å›:
   ```json
   {
     "success": true,
     "data": [
       {"code": "AU9999_BUY", "price": 971.0, ...}
     ]
   }
   ```

2. **æµ‹è¯•ä¸»é¡µ**
   ```
   http://ä½ çš„åœ°å€
   ```
   åº”è¯¥çœ‹åˆ°6ä¸ªä»·æ ¼å¡ç‰‡,å®æ—¶æ›´æ–°

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å®‰å…¨æ€§

å¦‚æœéƒ¨ç½²åˆ°å…¬ç½‘æœåŠ¡å™¨:

1. **é…ç½®é˜²ç«å¢™**
   ```bash
   sudo ufw enable
   sudo ufw allow 22    # SSH
   sudo ufw allow 80    # HTTP
   sudo ufw allow 443   # HTTPS
   ```

2. **é…ç½®HTTPS** (å¯é€‰)
   ```bash
   sudo apt install certbot python3-certbot-nginx -y
   sudo certbot --nginx -d ä½ çš„åŸŸå.com
   ```

### æ€§èƒ½

- Flaské»˜è®¤æ˜¯å•çº¿ç¨‹,ä½†æˆ‘å·²ç»é…ç½®äº† `threaded=True`
- å¦‚æœè®¿é—®é‡å¤§,å¯ä»¥ç”¨ gunicorn:
  ```bash
  pip install gunicorn
  gunicorn -w 4 -b 0.0.0.0:5000 server:app
  ```

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: è¿è¡Œserver.pyå,WebSocketä¸€ç›´è¿æ¥å¤±è´¥?

**A**: æ£€æŸ¥ç½‘ç»œ,ç¡®ä¿èƒ½è®¿é—® `wss://rtjwbqt.jzj9999.com:8443`

### Q: ç½‘é¡µèƒ½æ‰“å¼€,ä½†ä»·æ ¼ä¸æ˜¾ç¤º?

**A**:
1. æ£€æŸ¥ `/api/prices` æ˜¯å¦è¿”å›æ•°æ®
2. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—,çœ‹WebSocketæ˜¯å¦æˆåŠŸ

### Q: æœåŠ¡å™¨å…³é—­å,ç½‘ç«™å°±è®¿é—®ä¸äº†?

**A**: ä½¿ç”¨ systemd é…ç½®å¼€æœºè‡ªå¯

---

## ğŸ“ ç°åœ¨å¼€å§‹

**æœ€å¿«æ–¹å¼ (5åˆ†é’Ÿ):**

```bash
cd D:\API\å¤§å®—å•†å“ä»·æ ¼ç›‘æ§
pip install flask flask-cors websocket-client
python server.py
```

æ‰“å¼€æµè§ˆå™¨: http://localhost:5000

**çœ‹åˆ°ä»·æ ¼æ›´æ–°äº†å—?** ğŸ‰

---

**éœ€è¦å¸®ä½ é…ç½®äº‘æœåŠ¡å™¨éƒ¨ç½²å—?å‘Šè¯‰æˆ‘ä½ æƒ³ç”¨å“ªä¸ªæ–¹æ¡ˆ!**
